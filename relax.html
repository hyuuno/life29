<!DOCTYPE html>
<html lang="zh-CN" data-bg="gray">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life29 ¬∑ Relax</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Noto+Serif+SC:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <style>
        .relax-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 80px 20px 40px;
        }
        .relax-title {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 300;
            color: var(--color-text);
            margin-bottom: 12px;
            letter-spacing: 0.1em;
        }
        .relax-subtitle {
            font-size: 0.9rem;
            color: var(--color-text-muted);
            margin-bottom: 30px;
        }
        .game-list {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .game-tab {
            padding: 8px 20px;
            background: transparent;
            border: 1px solid var(--color-border);
            border-radius: 20px;
            font-size: 0.85rem;
            color: var(--color-text-light);
            cursor: pointer;
            transition: all 0.2s;
        }
        .game-tab:hover { border-color: var(--color-text-muted); }
        .game-tab.active {
            background: var(--color-text);
            color: var(--color-bg);
            border-color: var(--color-text);
        }
        .game-wrapper {
            width: 100%;
            max-width: 500px;
            background: var(--color-bg-card);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 30px rgba(0,0,0,0.1);
        }
        .game-area { display: none; }
        .game-area.active { display: block; }
        
        .color-game, .game-2048, .memory-game { text-align: center; }
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: var(--color-text-light);
        }
        .game-scores {
            display: flex;
            gap: 20px;
        }
        .high-score {
            color: #e8b4b8;
            font-size: 0.8rem;
        }
        .color-grid {
            display: grid;
            gap: 8px;
            margin: 0 auto 20px;
        }
        .color-tile {
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.15s;
        }
        .color-tile:hover { transform: scale(1.05); }
        .game-btn {
            padding: 10px 30px;
            background: var(--color-text);
            color: var(--color-bg);
            border: none;
            border-radius: 20px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .game-btn:hover { opacity: 0.8; }
        
        .grid-2048 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            background: var(--color-border);
            padding: 8px;
            border-radius: 8px;
            margin: 0 auto 20px;
            max-width: 320px;
        }
        .tile-2048 {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-weight: 500;
            font-size: 1.5rem;
            background: var(--color-bg);
            color: var(--color-text);
        }
        .tile-2048[data-value="2"] { background: #eee4da; color: #776e65; }
        .tile-2048[data-value="4"] { background: #ede0c8; color: #776e65; }
        .tile-2048[data-value="8"] { background: #f2b179; color: #fff; }
        .tile-2048[data-value="16"] { background: #f59563; color: #fff; }
        .tile-2048[data-value="32"] { background: #f67c5f; color: #fff; }
        .tile-2048[data-value="64"] { background: #f65e3b; color: #fff; }
        .tile-2048[data-value="128"] { background: #edcf72; color: #fff; }
        .tile-2048[data-value="256"] { background: #edcc61; color: #fff; }
        .tile-2048[data-value="512"] { background: #edc850; color: #fff; }
        .tile-2048[data-value="1024"] { background: #edc53f; color: #fff; font-size: 1.2rem; }
        .tile-2048[data-value="2048"] { background: #edc22e; color: #fff; font-size: 1.2rem; }
        
        .memory-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            max-width: 320px;
            margin: 0 auto 20px;
        }
        .memory-card {
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            background: var(--color-text);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s;
        }
        .memory-card.flipped { background: var(--color-bg); border: 2px solid var(--color-border); }
        .memory-card.matched { background: #c8e8c8; cursor: default; }
        
        .game-instructions {
            font-size: 0.8rem;
            color: var(--color-text-muted);
            margin-top: 16px;
        }
        
        .new-record {
            color: #e8b4b8;
            font-weight: 500;
            animation: pulse 0.5s ease-in-out;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
    </style>
</head>
<body>
    <div class="noise-overlay"></div>
    
    <header class="header">
        <a href="index.html" class="logo">
            <span class="logo-text">Life</span>
            <span class="logo-number">29</span>
        </a>
        <nav class="nav">
            <a href="index.html" class="nav-link">Âú∞ÁêÉ</a>
            <a href="#" class="nav-link">Êó∂Èó¥Á∫ø</a>
            <a href="#" class="nav-link">ÂõûÂøÜ</a>
            <a href="schedule.html" class="nav-link">ÂÅöÂí©</a>
            <a href="music.html" class="nav-link">Music</a>
            <a href="relax.html" class="nav-link active">Relax</a>
        </nav>
        <div class="header-actions">
            <button class="btn-icon theme-toggle" id="themeToggle" title="ÂàáÊç¢‰∏ªÈ¢ò">
                <svg class="icon-sun" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"></path></svg>
                <svg class="icon-moon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            </button>
        </div>
    </header>
    
    <main class="relax-container">
        <h1 class="relax-title">Take a Break</h1>
        <p class="relax-subtitle">ÊîæÊùæ‰∏Ä‰∏ãÔºåÁé©‰∏™Â∞èÊ∏∏Êàè</p>
        
        <div class="game-list">
            <button class="game-tab active" data-game="color">Color Tiles</button>
            <button class="game-tab" data-game="2048">2048</button>
            <button class="game-tab" data-game="memory">Memory</button>
        </div>
        
        <div class="game-wrapper">
            <div class="game-area active" id="colorGame">
                <div class="color-game">
                    <div class="game-info">
                        <div class="game-scores">
                            <span>Level: <strong id="colorLevel">1</strong></span>
                            <span>Score: <strong id="colorScore">0</strong></span>
                        </div>
                        <span class="high-score">ÊúÄÈ´ò: <strong id="colorHighScore">0</strong></span>
                    </div>
                    <div class="color-grid" id="colorGrid"></div>
                    <button class="game-btn" id="colorStartBtn">ÂºÄÂßãÊ∏∏Êàè</button>
                    <p class="game-instructions">ÊâæÂá∫È¢úËâ≤‰∏çÂêåÁöÑÊñπÂùó</p>
                </div>
            </div>
            
            <div class="game-area" id="game2048">
                <div class="game-2048">
                    <div class="game-info">
                        <div class="game-scores">
                            <span>Score: <strong id="score2048">0</strong></span>
                            <span class="high-score">ÊúÄÈ´ò: <strong id="highScore2048">0</strong></span>
                        </div>
                        <button class="game-btn" id="reset2048">ÈáçÊñ∞ÂºÄÂßã</button>
                    </div>
                    <div class="grid-2048" id="grid2048"></div>
                    <p class="game-instructions">‰ΩøÁî®ÊñπÂêëÈîÆÁßªÂä®ÊñπÂùó</p>
                </div>
            </div>
            
            <div class="game-area" id="memoryGame">
                <div class="memory-game">
                    <div class="game-info">
                        <div class="game-scores">
                            <span>Moves: <strong id="memoryMoves">0</strong></span>
                            <span class="high-score">ÊúÄÂ∞ë: <strong id="memoryBest">-</strong></span>
                        </div>
                        <button class="game-btn" id="resetMemory">ÈáçÊñ∞ÂºÄÂßã</button>
                    </div>
                    <div class="memory-grid" id="memoryGrid"></div>
                    <p class="game-instructions">ÊâæÂá∫ÊâÄÊúâÈÖçÂØπÁöÑÂç°Áâá</p>
                </div>
            </div>
        </div>
    </main>
    
    <script>
        // Theme
        const savedTheme = localStorage.getItem('life29-theme') || 'dark';
        document.documentElement.setAttribute('data-theme', savedTheme);
        document.getElementById('themeToggle').addEventListener('click', () => {
            const next = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('life29-theme', next);
        });
        
        // Tab switch
        document.querySelectorAll('.game-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.game-tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.game-area').forEach(g => g.classList.remove('active'));
                tab.classList.add('active');
                const id = tab.dataset.game === 'color' ? 'colorGame' : tab.dataset.game === '2048' ? 'game2048' : 'memoryGame';
                document.getElementById(id).classList.add('active');
            });
        });
        
        // ========== High Score Management ==========
        function getHighScore(game) {
            return parseInt(localStorage.getItem(`life29-${game}-highscore`) || '0');
        }
        function setHighScore(game, score) {
            localStorage.setItem(`life29-${game}-highscore`, score);
        }
        function getBestMoves() {
            const val = localStorage.getItem('life29-memory-best');
            return val ? parseInt(val) : null;
        }
        function setBestMoves(moves) {
            localStorage.setItem('life29-memory-best', moves);
        }
        
        // ========== Color Tiles ==========
        let colorLevel = 1, colorScore = 0;
        let colorHighScore = getHighScore('color');
        document.getElementById('colorHighScore').textContent = colorHighScore;
        
        function initColorGame() {
            const grid = document.getElementById('colorGrid');
            const size = Math.min(2 + Math.floor(colorLevel / 2), 6);
            grid.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            grid.style.maxWidth = `${size * 60}px`;
            grid.innerHTML = '';
            const hue = Math.random() * 360, sat = 50 + Math.random() * 30, light = 40 + Math.random() * 30;
            const diff = Math.max(30 - colorLevel * 2, 5);
            const diffIdx = Math.floor(Math.random() * size * size);
            for (let i = 0; i < size * size; i++) {
                const tile = document.createElement('div');
                tile.className = 'color-tile';
                tile.style.background = `hsl(${hue}, ${sat}%, ${i === diffIdx ? light + diff : light}%)`;
                if (i === diffIdx) tile.dataset.different = 'true';
                tile.onclick = () => {
                    if (tile.dataset.different) {
                        colorScore += colorLevel * 10;
                        colorLevel++;
                        // Check high score
                        if (colorScore > colorHighScore) {
                            colorHighScore = colorScore;
                            setHighScore('color', colorHighScore);
                            document.getElementById('colorHighScore').textContent = colorHighScore;
                            document.getElementById('colorHighScore').classList.add('new-record');
                            setTimeout(() => document.getElementById('colorHighScore').classList.remove('new-record'), 500);
                        }
                    } else {
                        colorLevel = 1;
                        colorScore = 0;
                    }
                    document.getElementById('colorScore').textContent = colorScore;
                    document.getElementById('colorLevel').textContent = colorLevel;
                    initColorGame();
                };
                grid.appendChild(tile);
            }
        }
        document.getElementById('colorStartBtn').onclick = () => { 
            colorLevel = 1; colorScore = 0; 
            document.getElementById('colorScore').textContent = 0; 
            document.getElementById('colorLevel').textContent = 1; 
            initColorGame(); 
        };
        initColorGame();
        
        // ========== 2048 ==========
        let grid2048 = Array(16).fill(0), score2048 = 0;
        let highScore2048 = getHighScore('2048');
        document.getElementById('highScore2048').textContent = highScore2048;
        
        function init2048() { 
            grid2048 = Array(16).fill(0); 
            score2048 = 0; 
            addTile(); addTile(); 
            render2048(); 
        }
        function addTile() { 
            const empty = grid2048.map((v, i) => v === 0 ? i : -1).filter(i => i >= 0); 
            if (empty.length) grid2048[empty[Math.floor(Math.random() * empty.length)]] = Math.random() < 0.9 ? 2 : 4; 
        }
        function render2048() { 
            const c = document.getElementById('grid2048'); 
            c.innerHTML = ''; 
            grid2048.forEach(v => { 
                const t = document.createElement('div'); 
                t.className = 'tile-2048'; 
                t.textContent = v || ''; 
                t.dataset.value = v; 
                c.appendChild(t); 
            }); 
            document.getElementById('score2048').textContent = score2048;
            // Check high score
            if (score2048 > highScore2048) {
                highScore2048 = score2048;
                setHighScore('2048', highScore2048);
                document.getElementById('highScore2048').textContent = highScore2048;
            }
        }
        function slide(arr) { 
            const f = arr.filter(x => x), m = []; 
            let i = 0; 
            while (i < f.length) { 
                if (i + 1 < f.length && f[i] === f[i + 1]) { 
                    m.push(f[i] * 2); 
                    score2048 += f[i] * 2; 
                    i += 2; 
                } else { 
                    m.push(f[i]); 
                    i++; 
                } 
            } 
            while (m.length < 4) m.push(0); 
            return m; 
        }
        function move2048(dir) { 
            const old = [...grid2048]; 
            if (dir === 'left' || dir === 'right') { 
                for (let r = 0; r < 4; r++) { 
                    let row = grid2048.slice(r * 4, r * 4 + 4); 
                    if (dir === 'right') row.reverse(); 
                    row = slide(row); 
                    if (dir === 'right') row.reverse(); 
                    for (let c = 0; c < 4; c++) grid2048[r * 4 + c] = row[c]; 
                } 
            } else { 
                for (let c = 0; c < 4; c++) { 
                    let col = [grid2048[c], grid2048[c + 4], grid2048[c + 8], grid2048[c + 12]]; 
                    if (dir === 'down') col.reverse(); 
                    col = slide(col); 
                    if (dir === 'down') col.reverse(); 
                    [grid2048[c], grid2048[c + 4], grid2048[c + 8], grid2048[c + 12]] = col; 
                } 
            } 
            if (old.join() !== grid2048.join()) addTile(); 
            render2048(); 
        }
        document.addEventListener('keydown', e => { 
            if (!document.getElementById('game2048').classList.contains('active')) return; 
            const m = { ArrowLeft: 'left', ArrowRight: 'right', ArrowUp: 'up', ArrowDown: 'down' }; 
            if (m[e.key]) { e.preventDefault(); move2048(m[e.key]); } 
        });
        document.getElementById('reset2048').onclick = init2048;
        init2048();
        
        // ========== Memory ==========
        const emojis = ['üå∏', 'üå∫', 'üåª', 'üåº', 'üå∑', 'üåπ', 'üíê', 'ü™ª'];
        let memoryCards = [], flipped = [], moves = 0, canFlip = true, matchedCount = 0;
        let memoryBest = getBestMoves();
        document.getElementById('memoryBest').textContent = memoryBest || '-';
        
        function initMemory() { 
            memoryCards = [...emojis, ...emojis].sort(() => Math.random() - 0.5); 
            flipped = []; moves = 0; canFlip = true; matchedCount = 0;
            document.getElementById('memoryMoves').textContent = 0; 
            const g = document.getElementById('memoryGrid'); 
            g.innerHTML = ''; 
            memoryCards.forEach((e, i) => { 
                const c = document.createElement('div'); 
                c.className = 'memory-card'; 
                c.onclick = () => flipCard(c, i); 
                g.appendChild(c); 
            }); 
        }
        function flipCard(card, i) { 
            if (!canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) return; 
            card.classList.add('flipped'); 
            card.textContent = memoryCards[i]; 
            flipped.push({ card, i }); 
            if (flipped.length === 2) { 
                moves++; 
                document.getElementById('memoryMoves').textContent = moves; 
                canFlip = false; 
                const [a, b] = flipped; 
                if (memoryCards[a.i] === memoryCards[b.i]) { 
                    a.card.classList.add('matched'); 
                    b.card.classList.add('matched'); 
                    flipped = []; 
                    canFlip = true;
                    matchedCount += 2;
                    // Check if game complete
                    if (matchedCount === 16) {
                        if (memoryBest === null || moves < memoryBest) {
                            memoryBest = moves;
                            setBestMoves(moves);
                            document.getElementById('memoryBest').textContent = memoryBest;
                            document.getElementById('memoryBest').classList.add('new-record');
                            setTimeout(() => document.getElementById('memoryBest').classList.remove('new-record'), 500);
                        }
                    }
                } else { 
                    setTimeout(() => { 
                        a.card.classList.remove('flipped'); 
                        a.card.textContent = ''; 
                        b.card.classList.remove('flipped'); 
                        b.card.textContent = ''; 
                        flipped = []; 
                        canFlip = true; 
                    }, 800); 
                } 
            } 
        }
        document.getElementById('resetMemory').onclick = initMemory;
        initMemory();
    </script>
</body>
</html>
